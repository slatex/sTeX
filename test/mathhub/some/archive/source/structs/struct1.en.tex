\def\mathhub{../../..}
\documentclass[debug=all]{stex}
\libinput{preamble}

\begin{document}

\noindent Document \printdocument

\begin{smodule}{struct1}

  \begin{mathstructure}{foostruct}[foo struct]
    \symdef{univ}{\mathcal U}
    \symdef{op}[args=a]{\argsep{#1}{\mathbin{\maincomp\circ}}}

    In structure: $\op{\svar a,\svar b,\svar c}$
  \end{mathstructure}

  With this:

  \begin{mathstructure}{foostructb}[this=\mathrm{foo},foo struct 2]
    \symdef{univ}{\mathcal U}
    \symdef{op}[args=a]{\argsep{#1}{\mathbin{\maincomp\circ _{\this}}}}

    In structure: $\op{\svar a,\svar b,\svar c}$
  \end{mathstructure}

  Instance:

  \symdef{structfoo}[return=\foostruct]{\mathcal F}

  Tests: $\structfoo!$ and $\structfoo{}$ and $\structfoo{univ}$ and $\structfoo{op}!$ and
  $\structfoo{op}{\svar a,\svar b,\svar c}$

  \vardef{vuniv}{U}

  \vardef{structfoo}[return={\foostruct[univ=\vuniv]}]{S}

  Tests: $\structfoo!$ and $\structfoo{}$ and $\structfoo{univ}$ and $\structfoo{op}!$ and
  $\structfoo{op}{\svar a,\svar b,\svar c}$

\end{smodule}

\end{document}